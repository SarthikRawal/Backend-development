// user.service.js file

export const signUp = async (userDetails) => {
  try {
    if (userDetails != null) {
      const hashedPassword = await bcrypt.hash(userDetails.password, 10);
      userDetails.password = hashedPassword;


      const data = await User.create(userDetails);

      return {
        code: HttpStatus.CREATED,
        data: data,
        message: "Created user successfully"
      };
    } else {
      return {
        code: HttpStatus.BAD_REQUEST,
        data: [],
        message: "details unavailable"
      };
    }

  } catch (error) {
    console.log(error);
    return {
      code: HttpStatus.INTERNAL_SERVER_ERROR,
      data: [],
      message: "Something went wrong"
    };
  }
}

export const signIn = async (userDetails) => {
  // console.log("--> user details", userDetails);
  try {
    if (!userDetails.email || !userDetails.password) {
      return {
        code: HttpStatus.BAD_REQUEST,
        data: [],
        message: "Email and password are required"
      };
    }

    const user = await User.findOne({ where: { email: userDetails.email } });

    if (!user) {
      return {
        code: HttpStatus.UNAUTHORIZED,
        data: [],
        message: "Invalid email or password"
      };
    }

    const validPassword = await bcrypt.compare(userDetails.password, user.password);

    if (!validPassword) {
      return {
        code: HttpStatus.UNAUTHORIZED,
        data: [],
        message: "Invalid email or password"
      };
    }
    return {
      code: HttpStatus.OK,
      data: [],
      message: "Login successful"
    };
  } catch (error) {
    return {
      code: HttpStatus.INTERNAL_SERVER_ERROR,
      data: [],
      message: "Something went wrong"
    };
  }

}


// user.controller.js file
export const signUp = async (req, res) => {
    const data = await UserService.signUp(req.body);
    res.status(data.code).json({
        code: data.code,
        data: data.data,
        message: data.message
    })
}

export const signIn = async (req, res) => {
    try {
        const data = await UserService.signIn(req.body);
        console.log("controller", data);
        res.status(data.code).json(data);

    } catch (error) {
        console.log(error);
        // throw error;
    }

}